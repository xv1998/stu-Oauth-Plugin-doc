(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{169:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"添加插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加插件","aria-hidden":"true"}},[t._v("#")]),t._v(" 添加插件")]),t._v(" "),s("p",[t._v("在使用插件前，首先要在小程序管理后台的“设置-第三方服务-插件管理”中添加插件。")]),t._v(" "),s("h1",{attrs:{id:"引入插件代码包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#引入插件代码包","aria-hidden":"true"}},[t._v("#")]),t._v(" 引入插件代码包")]),t._v(" "),s("p",[t._v("使用插件前，使用者要在 "),s("code",[t._v("app.json")]),t._v(" 中声明插件")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"plugins"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"myPlugin"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2.0.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"provider"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wxc44210f342bb2758"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h1",{attrs:{id:"开始授权"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开始授权","aria-hidden":"true"}},[t._v("#")]),t._v(" 开始授权")]),t._v(" "),s("h2",{attrs:{id:"时机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#时机","aria-hidden":"true"}},[t._v("#")]),t._v(" 时机")]),t._v(" "),s("p",[t._v("用户点击授权按钮开始授权")]),t._v(" "),s("h2",{attrs:{id:"调起授权页面"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调起授权页面","aria-hidden":"true"}},[t._v("#")]),t._v(" 调起授权页面")]),t._v(" "),s("p",[t._v("在点击授权按钮后，需要执行以下代码，执行后会跳转到插件的登陆页面")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v(" wx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("navigateTo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'plugin-private://wxc44210f342bb2758/pages/login/login?data='")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("传入的data为经过"),s("strong",[t._v("url编码")]),t._v("的"),s("strong",[t._v("JSON")]),t._v("字符串")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("属性")]),t._v(" "),s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("必填")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("state")]),t._v(" "),s("td",[t._v("string")]),t._v(" "),s("td",[t._v("是")]),t._v(" "),s("td",[t._v("客户端的当前状态")])]),t._v(" "),s("tr",[s("td",[t._v("client_id")]),t._v(" "),s("td",[t._v("string")]),t._v(" "),s("td",[t._v("是")]),t._v(" "),s("td",[t._v("客户端的ID")])]),t._v(" "),s("tr",[s("td",[t._v("scope")]),t._v(" "),s("td",[t._v("string")]),t._v(" "),s("td",[t._v("是")]),t._v(" "),s("td",[t._v("申请的权限范围")])])])]),t._v(" "),s("h2",{attrs:{id:"state的作用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#state的作用","aria-hidden":"true"}},[t._v("#")]),t._v(" state的作用")]),t._v(" "),s("p",[t._v("state参数，是由业务后台动态生成的唯一的随机值，这样确保了，不同的客户端，都拥有着不同的state。将请求加密放入session中，然后跟认证后台重定向后的state进行比对，一致才能确保授权请求来源于同一个客户端。")]),t._v(" "),s("p",[t._v("如果没有state参数，举个可能的攻击例子：")]),t._v(" "),s("blockquote",[s("ol",[s("li",[t._v("用户A在点击授权后，认证服务器将请求重定向到业务后台指定URL，并带上授权码")]),t._v(" "),s("li",[t._v("黑客B通过技术手段截取了用户A的重定向请求")]),t._v(" "),s("li",[t._v("黑客B在自己客户端发起重定向URL的请求")]),t._v(" "),s("li",[t._v("用户A的授权被黑客B窃取。")])])]),t._v(" "),s("p",[t._v("业务后台服务器没有办法知道重定向过来的请求，是否为用户A发出的")]),t._v(" "),s("p",[t._v("如果加入了state参数，在业务后台组装授权URL时，会给用户浏览器设置带有state的session，用户每次向业务后台发送请求，都会带上该session。在用户A在请求业务后台时，业务后台能从cookie中取出session，而黑客B的客户端发起的请求，是没有该session的，因此会导致授权失败")])])}],!1,null,null,null);a.default=e.exports}}]);